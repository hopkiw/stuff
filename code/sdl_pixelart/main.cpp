#include <SDL2/SDL.h>
#include <stdio.h>
#include <time.h>

#include <cstdlib>
#include <iostream>
#include <fstream>
#include <string>
#include <algorithm>
#include <set>
#include <vector>
#include <array>

const int SCREEN_WIDTH = 1080;
const int SCREEN_HEIGHT = 720;
const int WIDTH = 10;

SDL_Window* gWindow = NULL;
SDL_Renderer* gRenderer = NULL;

struct Color {
  int r, g, b;
};

bool operator==(const Color& lhs, const Color& rhs) {
  return lhs.r == rhs.r && lhs.g == rhs.g && lhs.b == rhs.b;
}

std::vector<int> getneighbors(int idx, int width, int length) {
  std::vector<int> res;
  // left
  if (idx != 0 && idx % width != 0) {
    res.push_back(idx - 1);
  }

  // right
  if ((idx + 1) != length && ((idx + 1) % width != 0)) {
    res.push_back(idx + 1);
  }

  // up
  if (idx - width > 0) {
    res.push_back(idx - width);
  }

  // down
  if ((idx + width) <= length) {
    res.push_back(idx + width);
  }

  return res;
}

class Tile {
 public:
    static const int TILE_WIDTH = 10;

    Tile(int, int, int);
    Tile(int, int, int, Color);
    Tile();

    void render();
    void move(int, int, int);
    void setcolor(Color);

 private:
    SDL_Rect mTile;
    Color color;
};

void Tile::move(int x, int y, int w) {
  mTile.x = x;
  mTile.y = y;
  mTile.w = w;
  mTile.h = w;
}

void Tile::setcolor(Color _color) {
  color = _color;
}

std::ostream& operator<<(std::ostream& os, const SDL_Rect& tile) {
    return os << "{"
              << "x: " << tile.x << ", "
              << "y: " << tile.y << ", "
              << "w: " << tile.w << ", "
              << "h: " << tile.h
              << "}";
}

Tile::Tile()
: color{} {
  mTile.x = 0;
  mTile.y = 0;
  mTile.w = 0;
  mTile.h = 0;
}

Tile::Tile(int x, int y, int w)
: color{} {
  mTile.x = x;
  mTile.y = y;
  mTile.w = w;
  mTile.h = w;
}

Tile::Tile(int x, int y, int w, Color c)
: color{c} {
  mTile.x = x;
  mTile.y = y;
  mTile.w = w;
  mTile.h = w;
}

void Tile::render() {
  SDL_SetRenderDrawColor(gRenderer, color.r, color.g, color.b, 0xFF);
  if (SDL_RenderFillRect(gRenderer, &mTile) != 0)
    SDL_Log("error rendering tile");
}

struct Camera {
  int x, y, z;
};

struct Change {
  int idx;
  Color color;
};

class TileField {
 public:
    TileField(int, int, int, int, std::array<Color, 10000>&);

    void render();
    void handle_click(int, int, bool);
    void end_event();
    void zoom(int);
    void pan(int, int);
    void play(std::vector<Change>);
    void set_color(Color c) { color = c; }

    // TODO: shouldn't need to be public
    std::vector<Change> changelist;

 private:
    int x, y, w, h;
    int last = -1;
    Camera camera;
    Color color;
    int to_fill = -1;
    std::array<Color, 10000>& real;
};

TileField::TileField(int _x, int _y, int _w, int _h, std::array<Color, 10000>& _real)
: x{_x}, y{_y}, w{_w}, h{_h}, camera{0, 0, 10}, color{}, real{_real} {
  for (int i = 0; i < (100*100); ++i) {
    real[i] = Color{0xFF, 0xFF, 0xFF};
  }
}

void TileField::render() {
  int cols = w / camera.z;
  int rows = h / camera.z;

  for (int _y = 0; _y < rows; ++_y) {
    for (int _x = 0; _x < cols; ++_x) {
      int i = ((_y + camera.y) * 100) + _x + camera.x;
      Color color = real[i];
      Tile t = {(_x * camera.z) + x, (_y * camera.z) + y, camera.z, color};
      t.render();
    }
  }
}

void TileField::handle_click(int click_x, int click_y, bool shift) {
  int tile_x = (click_x - x) / camera.z;
  int tile_y = (click_y - y) / camera.z;

  int idx = (((tile_y + camera.y) * 100) + tile_x + camera.x);
  if (idx == last)
    return;
  last = idx;

  if (shift == true) {
    to_fill = idx;
  } else {
    // "paint"
    changelist.push_back(Change{idx, real[idx]});
    real[idx] = color;
  }
}

void TileField::end_event() {
  if (to_fill == -1)
    return;

  Color replace = real[to_fill];
  std::set<int> pixels;
  pixels.insert(to_fill);
  while (pixels.size() != 0) {
    auto it = pixels.begin();
    changelist.push_back(Change{*it, real[*it]});
    real[*it] = color;
    for (auto i : getneighbors(*it, 100, 10000)) {
      if (real[i] == replace) {
        pixels.insert(i);
      }
    }
    pixels.erase(it);
  }

  to_fill = -1;
}

void TileField::zoom(int change) {
  camera.z = camera.z + change;
  if (camera.z < 4)
    camera.z = 4;
  if (camera.z > 100)
    camera.z = 100;
  pan(0, 0);
}

void TileField::pan(int change_x, int change_y) {
  camera.x = camera.x + change_x;
  if (camera.x + (w / camera.z) > 99)
    camera.x = 99 - (w / camera.z);
  if (camera.x < 0)
    camera.x = 0;

  camera.y = camera.y + change_y;
  if (camera.y + (h / camera.z) > 99)
    camera.y = 99 - (h / camera.z);
  if (camera.y < 0)
    camera.y = 0;
}

void TileField::play(std::vector<Change> changelist) {
  for (auto change : changelist) {
    real[change.idx] = change.color;
  }
}

typedef std::vector<Color> Palette;

class PaletteViewer {
 public:
    PaletteViewer(int, int);
    void render();
    void handle_click(int, int);
    Color& get_color();
    void next();
    void prev();

 private:
    std::vector<Palette> palettes = {
      Palette{
        Color{0x00, 0x00, 0x00},
        Color{0xFF, 0xFF, 0xFF},
        Color{0xFF, 0x00, 0x00},
        Color{0x00, 0xFF, 0x00},
        Color{0x00, 0x00, 0xFF},
        Color{0xFF, 0xFF, 0x00},
        Color{0x00, 0xFF, 0xFF},
        Color{0xFF, 0x00, 0xFF},
      },
      Palette{
        Color{0x1a, 0x35, 0x4a},
        Color{0xe8, 0x4d, 0x2e},
        Color{0x10, 0x88, 0x96},
        Color{0x70, 0x2a, 0x70},
      },
      Palette{
        Color{0xa1, 0x8e, 0x7a},
        Color{0xab, 0x97, 0xb5},
        Color{0xe4, 0x4b, 0x4a},
        Color{0xdc, 0x7e, 0x3b},
        Color{0x88, 0x95, 0x74},
        Color{0x67, 0x8e, 0xa3},
      },
      Palette{
        Color{0x3b, 0x01, 0x02},
        Color{0x76, 0x2b, 0x2c},
        Color{0xb6, 0x44, 0x3f},
        Color{0xc6, 0x7d, 0x58},
        Color{0xf5, 0xd6, 0xb1},
        Color{0xff, 0xf8, 0xdc},
      },
      Palette{
        Color{0xf8, 0xb1, 0x95},
        Color{0xc0, 0x6c, 0x84},
        Color{0x6c, 0x5b, 0x7b},
        Color{0x35, 0x5c, 0x7d},
        Color{0x73, 0x72, 0x5b},
        Color{0x00, 0x73, 0x54},
      },
      Palette{
        Color{0x64, 0x4e, 0x5b},
        Color{0x9d, 0x5a, 0x63},
        Color{0xc9, 0x65, 0x67},
        Color{0x5e, 0x78, 0x94},
        Color{0x31, 0x44, 0x55},
      },
      Palette{
        Color{0xf6, 0x08, 0x75},
        Color{0xf7, 0x7e, 0xdb},
        Color{0xf2, 0xa2, 0x8d},
        Color{0xf6, 0xd0, 0x14},
        Color{0x6c, 0xb4, 0xf7},
        Color{0x19, 0x98, 0xcb},
        Color{0x00, 0x35, 0xad},
        Color{0x00, 0x00, 0x00},
      },
      Palette{
        Color{0xdb, 0x9e, 0x68},
        Color{0x84, 0x9d, 0xb1},
        Color{0xa2, 0xce, 0xaa},
        Color{0x4f, 0x69, 0x80},
        Color{0xf4, 0x79, 0x42},
        Color{0x86, 0xbc, 0xb6},
        Color{0xb9, 0xaa, 0x97},
        Color{0x81, 0x75, 0xaa},
        Color{0xbf, 0xbb, 0x60},
        Color{0xe0, 0x79, 0x72},
        Color{0x1f, 0x96, 0x8b},
        Color{0xb6, 0x63, 0x53},
        Color{0xd7, 0xce, 0x9f},
        Color{0x7e, 0x75, 0x6d},
        Color{0xc3, 0x99, 0xb9},
        Color{0x63, 0x8b, 0x66},
      },
      Palette{
        Color{0x4e, 0x6c, 0x00},
        Color{0x8e, 0xb6, 0x5d},
        Color{0xf6, 0x76, 0xb7},
        Color{0xdc, 0x30, 0x80},
        Color{0x74, 0x30, 0x23},
      },
      Palette{
        Color{0x8a, 0xb6, 0x61},
        Color{0xfa, 0xbe, 0x0e},
        Color{0xfd, 0x86, 0x64},
        Color{0xec, 0xde, 0xc3},
        Color{0xe0, 0xe6, 0xe6},
      },
      Palette{
        Color{0xff, 0xd2, 0xd7},
        Color{0xfe, 0xd3, 0x8e},
        Color{0x90, 0xe4, 0xcd},
        Color{0x84, 0xdc, 0xe0},
        Color{0xfd, 0x65, 0xb2},
      },
      Palette{
        Color{0x20, 0x66, 0xb0},
        Color{0x43, 0x9b, 0xd4},
        Color{0x69, 0xbf, 0xe9},
        Color{0xd6, 0xb4, 0x27},
        Color{0xe3, 0x92, 0x98},
        Color{0xe9, 0x6d, 0x71},
        Color{0xe4, 0x26, 0x2c},
      },
      Palette{
        Color{0x5b, 0x4c, 0x51},
        Color{0x6a, 0x76, 0x60},
        Color{0x8c, 0xbe, 0xb3},
        Color{0xef, 0xb7, 0x5e},
        Color{0xf0, 0x60, 0x60},
      },
      Palette{
        Color{0xbc, 0xaf, 0x61},
        Color{0x96, 0x8a, 0x42},
        Color{0x6e, 0x64, 0x35},
        Color{0x2f, 0x2f, 0x1f},
        Color{0x4b, 0x29, 0x1f},
        Color{0x70, 0x32, 0x12},
        Color{0xc6, 0x8a, 0x20},
        Color{0xe4, 0xd2, 0x84},
      },
      Palette{
        Color{0xee, 0x1a, 0x24},
        Color{0xff, 0xb9, 0xdf},
        Color{0xff, 0xff, 0x00},
        Color{0xff, 0xb9, 0x45},
        Color{0x00, 0xff, 0xdf},
      },
      Palette{
        Color{0xae, 0x8f, 0x13},
        Color{0xc3, 0xc2, 0x78},
        Color{0xa7, 0xb4, 0xc5},
        Color{0x50, 0x6b, 0xab},
        Color{0x24, 0x44, 0x79},
        Color{0x16, 0x1a, 0x19},
      },
      Palette{
        Color{0xe1, 0xb4, 0x97},
        Color{0xfd, 0xee, 0xca},
        Color{0xe1, 0xd2, 0xaf},
        Color{0x9f, 0xa5, 0xa0},
        Color{0xba, 0xd0, 0xc3},
        Color{0x3a, 0x72, 0x98},
        Color{0x20, 0x3d, 0x5d},
      },
      Palette{
        Color{0xcc, 0x3b, 0x07},
        Color{0xdd, 0x73, 0x0a},
        Color{0xdf, 0x99, 0x3d},
        Color{0xf5, 0xd8, 0x8e},
        Color{0x9b, 0xc0, 0x86},
        Color{0x63, 0x8b, 0x60},
        Color{0x54, 0x6a, 0x6c},
        Color{0x1f, 0x2e, 0x29},
      },
      Palette{
        Color{0xd1, 0x21, 0x24},
        Color{0x1e, 0x4a, 0x55},
        Color{0x74, 0x30, 0x23},
        Color{0x3b, 0x51, 0x35},
        Color{0x4a, 0x31, 0x55},
      },
      Palette{
        Color{0x00, 0x4e, 0x70},
        Color{0x3c, 0x3b, 0x3b},
        Color{0xfb, 0xb0, 0x34},
        Color{0xe9, 0x54, 0x0d},
        Color{0xe4, 0x03, 0x2c},
        Color{0x81, 0xba, 0x26},
        Color{0x00, 0x83, 0x3e},
        Color{0x0b, 0x89, 0xd6},
        Color{0x63, 0x2c, 0x4f},
        Color{0xa7, 0x59, 0x27},
        Color{0x85, 0x77, 0x6f},
        Color{0x5d, 0x7e, 0x95},
      },
      Palette{
        Color{0x10, 0x2d, 0x42},
        Color{0x00, 0x81, 0xc0},
        Color{0xf8, 0x7e, 0x00},
        Color{0xed, 0xd1, 0xbb},
      },
      Palette{
        Color{0x28, 0x3d, 0x3b},
        Color{0x19, 0x72, 0x78},
        Color{0xed, 0xdd, 0xd4},
        Color{0xc4, 0x45, 0x36},
        Color{0x77, 0x2e, 0x25},
      },
      Palette{
        Color{0x33, 0x5c, 0x67},
        Color{0xff, 0xf3, 0xb0},
        Color{0xe0, 0x9f, 0x3e},
        Color{0x9e, 0x2a, 0x2b},
        Color{0x54, 0x0b, 0x0e},
      },
      Palette{
        Color{0x23, 0x3d, 0x4d},
        Color{0xfe, 0x7f, 0x2d},
        Color{0xfc, 0xca, 0x46},
        Color{0xa1, 0xc1, 0x81},
        Color{0x61, 0x9b, 0x8a},
      },
      Palette{
        Color{0x3d, 0x5a, 0x80},
        Color{0x98, 0xc1, 0xd9},
        Color{0xe0, 0xfb, 0xfc},
        Color{0xee, 0x6c, 0x4d},
        Color{0x29, 0x32, 0x41},
      },
      Palette{
        Color{0x26, 0x46, 0x53},
        Color{0x2a, 0x9d, 0x8f},
        Color{0xe9, 0xc4, 0x6a},
        Color{0xf4, 0xa2, 0x61},
        Color{0xe7, 0x6f, 0x51},
      },
      Palette{
        Color{0xef, 0x47, 0x6f},
        Color{0xff, 0xd1, 0x66},
        Color{0x06, 0xd6, 0xa0},
        Color{0x11, 0x8a, 0xb2},
        Color{0x07, 0x3b, 0x4c},
      },
      Palette{
        Color{0x00, 0x12, 0x19},
        Color{0x00, 0x5f, 0x73},
        Color{0x0a, 0x93, 0x96},
        Color{0x94, 0xd2, 0xbd},
        Color{0xe9, 0xd8, 0xa6},
        Color{0xee, 0x9b, 0x00},
        Color{0xca, 0x67, 0x02},
        Color{0xbb, 0x3e, 0x03},
        Color{0xae, 0x20, 0x12},
        Color{0x9b, 0x22, 0x26},
      },
      Palette{
        Color{0x00, 0x12, 0x19},
        Color{0x00, 0x5f, 0x73},
        Color{0x0a, 0x93, 0x96},
        Color{0x94, 0xd2, 0xbd},
        Color{0xe9, 0xd8, 0xa6},
        Color{0xee, 0x9b, 0x00},
        Color{0xca, 0x67, 0x02},
        Color{0xae, 0x20, 0x12},
        Color{0x9b, 0x22, 0x26},
      },
      Palette{
        Color{0xff, 0xe0, 0xe9},
        Color{0xff, 0xc2, 0xd4},
        Color{0xff, 0x9e, 0xbb},
        Color{0xff, 0x7a, 0xa2},
        Color{0xe0, 0x57, 0x80},
        Color{0xb9, 0x37, 0x5e},
        Color{0x8a, 0x28, 0x46},
        Color{0x60, 0x24, 0x37},
        Color{0x52, 0x2e, 0x38},
      },
      Palette{
        Color{0x13, 0x3c, 0x55},
        Color{0x38, 0x6f, 0xa4},
        Color{0x59, 0xa5, 0xd8},
        Color{0x84, 0xd2, 0xf6},
        Color{0x91, 0xe5, 0xf6},
      },
      Palette{
        Color{0x1a, 0x14, 0x23},
        Color{0x37, 0x25, 0x49},
        Color{0x77, 0x4c, 0x60},
        Color{0xb7, 0x5d, 0x69},
        Color{0xea, 0xcd, 0xc2},
      },
      Palette{
        Color{0xcc, 0xdb, 0xdc},
        Color{0x9a, 0xd1, 0xd4},
        Color{0x80, 0xce, 0xd7},
        Color{0x00, 0x7e, 0xa7},
        Color{0x00, 0x32, 0x49},
      },
      Palette{
        Color{0x03, 0x07, 0x1e},
        Color{0x37, 0x06, 0x17},
        Color{0x6a, 0x04, 0x0f},
        Color{0x9d, 0x02, 0x08},
        Color{0xd0, 0x00, 0x00},
        Color{0xdc, 0x2f, 0x02},
        Color{0xe8, 0x5d, 0x04},
        Color{0xf4, 0x8c, 0x06},
        Color{0xfa, 0xa3, 0x07},
        Color{0xff, 0xba, 0x08},
      },
      Palette{
        Color{0x0b, 0x39, 0x54},
        Color{0x08, 0x7e, 0x8b},
        Color{0xbf, 0xd7, 0xea},
        Color{0xff, 0x5a, 0x5f},
        Color{0xc8, 0x1d, 0x25},
      },
      Palette{
        Color{0xff, 0x6d, 0x00},
        Color{0xff, 0x79, 0x00},
        Color{0xff, 0x85, 0x00},
        Color{0xff, 0x91, 0x00},
        Color{0xff, 0x9e, 0x00},
        Color{0x9d, 0x4e, 0xdd},
        Color{0x7b, 0x2c, 0xbf},
        Color{0x5a, 0x18, 0x9a},
        Color{0x3c, 0x09, 0x6c},
        Color{0x24, 0x00, 0x46},
      },
      Palette{
        Color{0xb8, 0x18, 0x40},
        Color{0xea, 0x6a, 0x48},
        Color{0xfc, 0x85, 0x77},
        Color{0xd4, 0x6c, 0x97},
        Color{0x63, 0x4f, 0x8d},
        Color{0x00, 0x41, 0x77},
      },
      Palette{
        Color{0xff, 0x7d, 0x0c},
        Color{0xea, 0xbd, 0x85},
        Color{0xbf, 0xbf, 0xbf},
        Color{0x9c, 0xd5, 0xdb},
        Color{0x01, 0xa0, 0xa8},
      },
      Palette{
        Color{0x51, 0x95, 0xc5},
        Color{0xff, 0x9c, 0x44},
        Color{0xdf, 0x57, 0x58},
        Color{0x95, 0xc7, 0xc3},
        Color{0x75, 0xb3, 0x93},
        Color{0xe9, 0x95, 0xd0},
        Color{0x9c, 0x9c, 0x9c},
      },
      Palette{
        Color{0xf8, 0xb1, 0x95},
        Color{0xf6, 0x72, 0x80},
        Color{0xc0, 0x6c, 0x84},
        Color{0x6c, 0x5b, 0x7b},
        Color{0x35, 0x5c, 0x7d},
      },
      Palette{
        Color{0x99, 0xb8, 0x98},
        Color{0xfe, 0xce, 0xab},
        Color{0xff, 0x84, 0x7c},
        Color{0xe8, 0x4a, 0x5f},
        Color{0x2a, 0x36, 0x3b},
      },
      Palette{
        Color{0xa8, 0xe6, 0xce},
        Color{0xdc, 0xed, 0xc2},
        Color{0xff, 0xd3, 0xb5},
        Color{0xff, 0xaa, 0xa6},
        Color{0xff, 0x8c, 0x94},
      },
      Palette{
        Color{0xa8, 0xa7, 0xa7},
        Color{0xcc, 0x52, 0x7a},
        Color{0xe8, 0x17, 0x5d},
        Color{0x47, 0x47, 0x47},
        Color{0x36, 0x36, 0x36},
      },
      Palette{
        Color{0xa7, 0x22, 0x6e},
        Color{0xec, 0x20, 0x49},
        Color{0xf2, 0x6b, 0x38},
        Color{0xf7, 0xdb, 0x4f},
        Color{0x2f, 0x95, 0x99},
      },
      Palette{
        Color{0xe1, 0xf5, 0xc4},
        Color{0xed, 0xe5, 0x74},
        Color{0xf9, 0xd4, 0x23},
        Color{0xfc, 0x91, 0x3a},
        Color{0xff, 0x4e, 0x50},
      },
      Palette{
        Color{0xe5, 0xfc, 0xc2},
        Color{0x9d, 0xe0, 0xad},
        Color{0x45, 0xad, 0xa8},
        Color{0x54, 0x79, 0x80},
        Color{0x59, 0x4f, 0x4f},
      },
      Palette{
        Color{0xfe, 0x43, 0x65},
        Color{0xfc, 0x9d, 0x9a},
        Color{0xf9, 0xcd, 0xad},
        Color{0xc8, 0xc8, 0xa9},
        Color{0x83, 0xaf, 0x9b},
      },
      Palette{
        Color{0xff, 0xcc, 0xbb},
        Color{0x6e, 0xb5, 0xc0},
        Color{0x00, 0x6c, 0x84},
        Color{0xe2, 0xe8, 0xe4},
      },
      Palette{
        Color{0x26, 0x2f, 0x34},
        Color{0xf3, 0x4a, 0x4a},
        Color{0xf1, 0xd3, 0xbc},
        Color{0x61, 0x50, 0x49},
      },
      Palette{
        Color{0xa4, 0x95, 0x92},
        Color{0x72, 0x70, 0x77},
        Color{0xee, 0xd8, 0xc9},
        Color{0xe9, 0x97, 0x87},
      },
      Palette{
        Color{0x0f, 0x1f, 0x38},
        Color{0x8e, 0x79, 0x70},
        Color{0xf5, 0x54, 0x49},
        Color{0x1b, 0x4b, 0x5a},
      },
      Palette{
        Color{0x90, 0xaf, 0xc5},
        Color{0x33, 0x6b, 0x87},
        Color{0x2a, 0x31, 0x32},
        Color{0x76, 0x36, 0x26},
      },
      Palette{
        Color{0x44, 0x4c, 0x5c},
        Color{0xce, 0x5a, 0x57},
        Color{0x78, 0xa5, 0xa3},
        Color{0xe1, 0xb1, 0x6a},
      },
      Palette{
        Color{0x2c, 0x4a, 0x52},
        Color{0x53, 0x70, 0x72},
        Color{0x8e, 0x9b, 0x97},
        Color{0xf4, 0xeb, 0xdb},
      },
      Palette{
        Color{0x00, 0x3b, 0x46},
        Color{0x07, 0x57, 0x5b},
        Color{0x66, 0xa5, 0xad},
        Color{0xc4, 0xdf, 0xe6},
      },
      Palette{
        Color{0xfe, 0xe5, 0xd9},
        Color{0xfc, 0xae, 0x91},
        Color{0xde, 0x2d, 0x26},
        Color{0xef, 0xf3, 0xff},
        Color{0xbd, 0xd7, 0xe7},
        Color{0x6b, 0xae, 0xd6},
        Color{0x31, 0x82, 0xbd},
        Color{0xf7, 0xf7, 0xf7},
        Color{0xcc, 0xcc, 0xcc},
        Color{0x96, 0x96, 0x96},
      },
      Palette{
        Color{0xde, 0x2d, 0x26},
        Color{0xa5, 0x0f, 0x15},
        Color{0x08, 0x51, 0x9c},
        Color{0x63, 0x63, 0x63},
        Color{0x25, 0x25, 0x25},
      },
      Palette{
        Color{0xfe, 0xe5, 0xd9},
        Color{0xfc, 0xae, 0x91},
        Color{0xde, 0x2d, 0x26},
        Color{0xef, 0xf3, 0xff},
        Color{0xbd, 0xd7, 0xe7},
        Color{0x6b, 0xae, 0xd6},
        Color{0x31, 0x82, 0xbd},
        Color{0xf7, 0xf7, 0xf7},
        Color{0xcc, 0xcc, 0xcc},
        Color{0x96, 0x96, 0x96},
      },
      Palette{
        Color{0xde, 0x2d, 0x26},
        Color{0xa5, 0x0f, 0x15},
        Color{0x29, 0x50, 0x9c},
        Color{0x63, 0x63, 0x63},
        Color{0x25, 0x25, 0x25},
      },
      Palette{
        Color{0xfe, 0xe5, 0xd9},
        Color{0xfc, 0xae, 0x91},
        Color{0xfb, 0x6a, 0x4a},
        Color{0xde, 0x2d, 0x26},
        Color{0xef, 0xf3, 0xff},
        Color{0xbd, 0xd7, 0xe7},
        Color{0x6b, 0xae, 0xd6},
        Color{0x31, 0x82, 0xbd},
        Color{0xf7, 0xf7, 0xf7},
        Color{0xcc, 0xcc, 0xcc},
        Color{0x96, 0x96, 0x96},
      },
      Palette{
        Color{0x63, 0x63, 0x63},
        Color{0x25, 0x25, 0x25},
        Color{0x08, 0x51, 0x9c},
        Color{0xe1, 0x00, 0x7d},
        Color{0xb9, 0x1e, 0x50},
      },
      Palette{
        Color{0xf5, 0xdf, 0x4d},
        Color{0x0f, 0x4c, 0x81},
        Color{0xfa, 0x72, 0x68},
        Color{0x5f, 0x4b, 0x8b},
        Color{0x88, 0xb0, 0x4b},
        Color{0xf7, 0xca, 0xc9},
        Color{0xb3, 0xce, 0xe5},
        Color{0xb5, 0x71, 0x70},
        Color{0xb6, 0x56, 0xa7},
      },
      Palette{
        Color{0x06, 0xd6, 0xa0},
        Color{0xf7, 0xf7, 0xff},
        Color{0xff, 0xd1, 0x66},
        Color{0x4a, 0x66, 0x70},
        Color{0x08, 0x12, 0x17},
        Color{0x16, 0x21, 0x31},
      },
      Palette{
        Color{0xf7, 0xf4, 0xf9},
        Color{0xe7, 0xe1, 0xef},
        Color{0xd4, 0xb9, 0xda},
        Color{0xc9, 0x94, 0xc7},
        Color{0xdf, 0x65, 0xb0},
        Color{0xe7, 0x29, 0x8a},
        Color{0xce, 0x12, 0x56},
        Color{0x98, 0x00, 0x43},
        Color{0x67, 0x00, 0x1f},
      },
      Palette{
        Color{0xff, 0xff, 0xcc},
        Color{0xff, 0xed, 0xa0},
        Color{0xfe, 0xd9, 0x76},
        Color{0xfe, 0xb2, 0x4c},
        Color{0xfd, 0x8d, 0x3c},
        Color{0xfc, 0x4e, 0x2a},
        Color{0xe3, 0x1a, 0x1c},
        Color{0xbd, 0x00, 0x26},
        Color{0x80, 0x00, 0x26},
      },
      Palette{
        Color{0x44, 0x01, 0x54},
        Color{0x48, 0x15, 0x67},
        Color{0x48, 0x26, 0x77},
        Color{0x45, 0x37, 0x81},
        Color{0x40, 0x47, 0x88},
        Color{0x39, 0x56, 0x8c},
        Color{0x33, 0x63, 0x8d},
        Color{0x2d, 0x70, 0x8e},
        Color{0x28, 0x7d, 0x8e},
        Color{0x23, 0x8a, 0x8d},
        Color{0x1f, 0x96, 0x8b},
        Color{0x20, 0xa3, 0x87},
        Color{0x29, 0xaf, 0x7f},
        Color{0x3c, 0xbb, 0x75},
        Color{0x55, 0xc6, 0x67},
        Color{0x73, 0xd0, 0x55},
        Color{0x95, 0xd8, 0x40},
        Color{0xb8, 0xde, 0x29},
        Color{0xdc, 0xe3, 0x19},
        Color{0xfd, 0xe7, 0x25},
      },
      Palette{
        Color{0x0e, 0x08, 0x88},
        Color{0x2d, 0x06, 0x94},
        Color{0x44, 0x04, 0x9e},
        Color{0x59, 0x00, 0xa4},
        Color{0x6f, 0x01, 0xa8},
        Color{0x84, 0x05, 0xa7},
        Color{0x95, 0x11, 0xa2},
        Color{0xa7, 0x21, 0x96},
        Color{0xb5, 0x30, 0x8a},
        Color{0xc5, 0x40, 0x7d},
        Color{0xd1, 0x4e, 0x73},
        Color{0xdc, 0x5d, 0x66},
        Color{0xe7, 0x6e, 0x5b},
        Color{0xef, 0x7e, 0x4e},
        Color{0xf7, 0x90, 0x44},
        Color{0xfb, 0xa1, 0x38},
        Color{0xfe, 0xb7, 0x2c},
        Color{0xfd, 0xcc, 0x26},
        Color{0xf7, 0xe2, 0x26},
        Color{0xf0, 0xf9, 0x21},
      },
      Palette{
        Color{0x0e, 0x08, 0x88},
        Color{0x2d, 0x06, 0x94},
        Color{0x44, 0x04, 0x9e},
        Color{0x59, 0x00, 0xa4},
        Color{0x6f, 0x01, 0xa8},
        Color{0x84, 0x05, 0xa7},
        Color{0x95, 0x11, 0xa2},
        Color{0xa7, 0x21, 0x96},
        Color{0xb5, 0x30, 0x8a},
        Color{0xc5, 0x40, 0x7d},
        Color{0xd1, 0x4e, 0x73},
        Color{0xdc, 0x5d, 0x66},
        Color{0xe7, 0x6e, 0x5b},
        Color{0xef, 0x7e, 0x4e},
        Color{0xf7, 0x90, 0x44},
        Color{0xfb, 0xa1, 0x38},
        Color{0xfe, 0xb7, 0x2c},
        Color{0xfd, 0xcc, 0x26},
        Color{0xf7, 0xe2, 0x26},
        Color{0xf0, 0xf9, 0x21},
      },
      Palette{
        Color{0x00, 0x00, 0x05},
        Color{0x08, 0x06, 0x16},
        Color{0x11, 0x0b, 0x2d},
        Color{0x1e, 0x08, 0x48},
        Color{0x30, 0x00, 0x60},
        Color{0x43, 0x00, 0x6a},
        Color{0x57, 0x09, 0x6e},
        Color{0x6b, 0x11, 0x6f},
        Color{0x81, 0x17, 0x6d},
        Color{0x98, 0x1d, 0x69},
        Color{0xb0, 0x23, 0x63},
        Color{0xc9, 0x2d, 0x59},
        Color{0xe0, 0x3b, 0x50},
        Color{0xed, 0x50, 0x4a},
        Color{0xf6, 0x6b, 0x4d},
        Color{0xfa, 0x86, 0x57},
        Color{0xfb, 0xa3, 0x68},
        Color{0xfb, 0xc1, 0x7d},
        Color{0xfc, 0xdf, 0x96},
        Color{0xfc, 0xff, 0xb2},
      },
      Palette{
        Color{0x00, 0x00, 0x05},
        Color{0x08, 0x06, 0x16},
        Color{0x11, 0x0b, 0x2d},
        Color{0x1e, 0x08, 0x48},
        Color{0x30, 0x00, 0x60},
        Color{0x43, 0x00, 0x6a},
        Color{0x57, 0x09, 0x6e},
        Color{0x6b, 0x11, 0x6f},
        Color{0x81, 0x17, 0x6d},
        Color{0x98, 0x1d, 0x69},
        Color{0xb0, 0x23, 0x63},
        Color{0xc9, 0x2d, 0x59},
        Color{0xe0, 0x3b, 0x50},
        Color{0xed, 0x50, 0x4a},
        Color{0xf6, 0x6b, 0x4d},
        Color{0xfa, 0x86, 0x57},
        Color{0xfb, 0xa3, 0x68},
        Color{0xfb, 0xc1, 0x7d},
        Color{0xfc, 0xdf, 0x96},
        Color{0xfc, 0xff, 0xb2},
      },
      Palette{
        Color{0xef, 0xeb, 0xe9},
        Color{0xd7, 0xcc, 0xc8},
        Color{0xbc, 0xaa, 0xa4},
        Color{0xa1, 0x88, 0x7f},
        Color{0x8d, 0x6e, 0x63},
        Color{0x79, 0x55, 0x48},
        Color{0x6d, 0x4c, 0x41},
        Color{0x5d, 0x40, 0x37},
        Color{0x4e, 0x34, 0x2e},
        Color{0x3e, 0x27, 0x23},
      },
      Palette{
        Color{0xec, 0xef, 0xf1},
        Color{0xcf, 0xd8, 0xdc},
        Color{0xb0, 0xbe, 0xc5},
        Color{0x90, 0xa4, 0xae},
        Color{0x78, 0x90, 0x9c},
        Color{0x60, 0x7d, 0x8b},
        Color{0x54, 0x6e, 0x7a},
        Color{0x45, 0x5a, 0x64},
        Color{0x37, 0x47, 0x4f},
        Color{0x26, 0x32, 0x38},
      },
      Palette{
        Color{0xe8, 0xf8, 0xf5},
        Color{0xd1, 0xf2, 0xeb},
        Color{0xa3, 0xe4, 0xd7},
        Color{0x76, 0xd7, 0xc4},
        Color{0x48, 0xc9, 0xb0},
        Color{0x1a, 0xbc, 0x9c},
        Color{0x17, 0xa5, 0x89},
        Color{0x14, 0x8f, 0x77},
        Color{0x11, 0x78, 0x64},
        Color{0x0e, 0x62, 0x51},
      },
      Palette{
        Color{0xeb, 0xf5, 0xfb},
        Color{0xd6, 0xea, 0xf8},
        Color{0xae, 0xd6, 0xf1},
        Color{0x85, 0xc1, 0xe9},
        Color{0x5d, 0xad, 0xe2},
        Color{0x34, 0x98, 0xdb},
        Color{0x2e, 0x86, 0xc1},
        Color{0x28, 0x74, 0xa6},
        Color{0x21, 0x61, 0x8c},
        Color{0x1b, 0x4f, 0x72},
      },
      Palette{
        Color{0xf5, 0xee, 0xf8},
        Color{0xeb, 0xde, 0xf0},
        Color{0xd7, 0xbd, 0xe2},
        Color{0xc3, 0x9b, 0xd3},
        Color{0xaf, 0x7a, 0xc5},
        Color{0x9b, 0x59, 0xb6},
        Color{0x88, 0x4e, 0xa0},
        Color{0x76, 0x44, 0x8a},
        Color{0x63, 0x39, 0x74},
        Color{0x51, 0x2e, 0x5f},
      },
      Palette{
        Color{0xfd, 0xed, 0xec},
        Color{0xfa, 0xdb, 0xd8},
        Color{0xf5, 0xb7, 0xb1},
        Color{0xf1, 0x94, 0x8a},
        Color{0xec, 0x70, 0x63},
        Color{0xe7, 0x4c, 0x3c},
        Color{0xcb, 0x43, 0x35},
        Color{0xb0, 0x3a, 0x2e},
        Color{0x94, 0x31, 0x26},
        Color{0x78, 0x28, 0x1f},
      },
      Palette{
        Color{0xf2, 0xf5, 0xd3},
        Color{0xb6, 0xd7, 0xbb},
        Color{0x62, 0xab, 0xa0},
        Color{0x2b, 0x8f, 0x91},
        Color{0x61, 0x4e, 0x66},
      },
      Palette{
        Color{0xfa, 0xa2, 0x75},
        Color{0xff, 0x8c, 0x61},
        Color{0xce, 0x6a, 0x85},
        Color{0x98, 0x52, 0x77},
        Color{0x5c, 0x37, 0x4c},
      },
      Palette{
        Color{0xd8, 0xf3, 0xdc},
        Color{0xb7, 0xe4, 0xc7},
        Color{0x95, 0xd5, 0xb2},
        Color{0x74, 0xc6, 0x9d},
        Color{0x52, 0xb7, 0x88},
        Color{0x40, 0x91, 0x6c},
        Color{0x2d, 0x6a, 0x4f},
        Color{0x1b, 0x43, 0x32},
        Color{0x08, 0x1c, 0x15},
      },
      Palette{
        Color{0xf5, 0x54, 0x49},
        Color{0xd1, 0x53, 0x4c},
        Color{0xac, 0x51, 0x4f},
        Color{0x88, 0x50, 0x52},
        Color{0x64, 0x4e, 0x54},
        Color{0x3f, 0x4d, 0x57},
        Color{0x1b, 0x4b, 0x5a},
      },
      Palette{
        Color{0x5d, 0x5c, 0x61},
        Color{0x37, 0x96, 0x83},
        Color{0x73, 0x95, 0xae},
        Color{0x55, 0x7a, 0x95},
        Color{0xb1, 0xa2, 0x96},
      },
      Palette{
        Color{0x69, 0x88, 0x90},
        Color{0x5f, 0x7a, 0x82},
        Color{0x54, 0x6d, 0x73},
        Color{0x4a, 0x5f, 0x65},
        Color{0x3f, 0x52, 0x56},
        Color{0x35, 0x44, 0x48},
        Color{0x2a, 0x36, 0x3a},
        Color{0x20, 0x29, 0x2b},
        Color{0x15, 0x1b, 0x1d},
        Color{0x0a, 0x0e, 0x0e},
      },
      Palette{
        Color{0xff, 0x68, 0x8c},
        Color{0xe9, 0x60, 0x9c},
        Color{0xcd, 0x5d, 0xa9},
        Color{0xab, 0x5d, 0xb2},
        Color{0x83, 0x5e, 0xb5},
        Color{0x55, 0x5e, 0xb2},
        Color{0x00, 0x5d, 0xa9},
      },
      Palette{
        Color{0xff, 0x00, 0x00},
        Color{0xcc, 0x00, 0x00},
        Color{0x99, 0x00, 0x00},
        Color{0x33, 0x00, 0x00},
        Color{0x00, 0x00, 0x00},
        Color{0x33, 0x00, 0x00},
        Color{0x99, 0x00, 0x00},
        Color{0xcc, 0x00, 0x00},
        Color{0xff, 0x00, 0x00},
      },
      Palette{
        Color{0x2b, 0x5c, 0x8a},
        Color{0x5c, 0x91, 0xbf},
        Color{0x83, 0xb8, 0xda},
        Color{0x11, 0x11, 0x11},
        Color{0xfa, 0xa3, 0x44},
        Color{0xe9, 0x6e, 0x22},
        Color{0x9e, 0x3d, 0x22},
      },
      Palette{
        Color{0xe4, 0x40, 0x3e},
        Color{0xe4, 0x63, 0x21},
        Color{0x8a, 0x52, 0x1f},
        Color{0xb3, 0x85, 0x8c},
        Color{0x33, 0xb5, 0xbf},
        Color{0x65, 0x81, 0x81},
        Color{0x3a, 0x76, 0x8a},
      },
      Palette{
        Color{0xff, 0xff, 0xff},
        Color{0xcc, 0xcc, 0xcc},
        Color{0x00, 0x00, 0x00},
        Color{0xff, 0x04, 0x00},
        Color{0x8c, 0xb4, 0x00},
        Color{0x05, 0x64, 0xff},
      },
      Palette{
        Color{0xe5, 0x24, 0x3b},
        Color{0xdd, 0xa6, 0x3a},
        Color{0x4c, 0x9f, 0x38},
        Color{0xc5, 0x19, 0x2d},
        Color{0xff, 0x3a, 0x21},
        Color{0x26, 0xbd, 0xe2},
        Color{0xfc, 0xc3, 0x0b},
        Color{0xa2, 0x19, 0x42},
        Color{0xfd, 0x69, 0x25},
        Color{0xdd, 0x13, 0x67},
        Color{0xfd, 0x9d, 0x24},
        Color{0xbf, 0x8b, 0x2e},
        Color{0x3f, 0x7e, 0x44},
        Color{0x0a, 0x97, 0xd9},
        Color{0x56, 0xc0, 0x2b},
        Color{0x00, 0x68, 0x9d},
        Color{0x19, 0x48, 0x6a},
      },
      Palette{
        Color{0xf2, 0xc1, 0x2e},
        Color{0xf2, 0xac, 0x29},
        Color{0xd9, 0x52, 0x04},
        Color{0x8c, 0x0e, 0x03},
        Color{0x26, 0x01, 0x01},
      },
      Palette{
        Color{0xf2, 0x3e, 0x16},
        Color{0x73, 0x1d, 0x0a},
        Color{0xf2, 0x7a, 0x5e},
        Color{0x0d, 0x0d, 0x0d},
        Color{0xf2, 0xf2, 0xf2},
      },
      Palette{
        Color{0xbc, 0xdc, 0xa5},
        Color{0xff, 0xff, 0x7f},
        Color{0xf2, 0x88, 0x2d},
        Color{0x75, 0x80, 0x87},
        Color{0x3b, 0x7e, 0xa1},
        Color{0x00, 0x32, 0x62},
        Color{0x81, 0x46, 0x5b},
      },
      Palette{
        Color{0xd7, 0xd0, 0xc2},
        Color{0xc1, 0xb3, 0xa3},
        Color{0x77, 0x89, 0x88},
        Color{0x17, 0x8e, 0xa3},
        Color{0x09, 0x6c, 0x88},
        Color{0x09, 0x42, 0x55},
        Color{0x08, 0x56, 0x6e},
      },
      Palette{
        Color{0xca, 0x3b, 0x5d},
        Color{0x58, 0x7f, 0xc5},
        Color{0x62, 0xa5, 0xdd},
        Color{0xc7, 0xc8, 0xe4},
        Color{0x90, 0xbf, 0xdf},
        Color{0x80, 0x39, 0x5e},
        Color{0xb2, 0x7d, 0x9c},
      },
      Palette{
        Color{0xd6, 0xda, 0xec},
        Color{0xc3, 0xc5, 0xdc},
        Color{0xaf, 0xb0, 0xd1},
        Color{0x97, 0x9e, 0xc9},
        Color{0x73, 0x82, 0xc0},
        Color{0x4d, 0x5b, 0xae},
        Color{0x2d, 0x39, 0x69},
      },
      Palette{
        Color{0xd6, 0x6d, 0x5d},
        Color{0xd5, 0xb4, 0xa7},
        Color{0xca, 0x92, 0x84},
        Color{0xc6, 0x5d, 0x50},
        Color{0xb0, 0x4b, 0x40},
        Color{0x83, 0x43, 0x3a},
        Color{0x31, 0x19, 0x18},
      },
      Palette{
        Color{0xd4, 0xa1, 0x43},
        Color{0xd1, 0xc4, 0x8b},
        Color{0xc9, 0x89, 0x36},
        Color{0xc7, 0x63, 0x2d},
        Color{0x82, 0x81, 0x7a},
        Color{0x5a, 0x4c, 0x1e},
        Color{0x11, 0x0e, 0x0b},
      },
      Palette{
        Color{0xff, 0xff, 0xff},
        Color{0x1a, 0xb2, 0xd7},
        Color{0x0c, 0x74, 0x9d},
        Color{0x03, 0x30, 0x4d},
        Color{0x00, 0x00, 0x00},
        Color{0x8f, 0x3b, 0x5a},
        Color{0xfb, 0xa4, 0x00},
        Color{0xf9, 0x73, 0x09},
        Color{0xd5, 0x42, 0x17},
        Color{0x8d, 0x8b, 0x8b},
      },
      Palette{
        Color{0xa2, 0xb2, 0xcd},
        Color{0xea, 0xd8, 0xae},
        Color{0xc9, 0xcc, 0xcd},
        Color{0xed, 0xbd, 0x65},
        Color{0xcf, 0xb8, 0xc0},
        Color{0xe7, 0xa4, 0x58},
        Color{0xa7, 0xbf, 0x97},
        Color{0x54, 0x7b, 0x52},
        Color{0x2e, 0x48, 0x95},
        Color{0xfe, 0x80, 0x3f},
        Color{0xd6, 0xaf, 0x57},
      },
      Palette{
        Color{0x3f, 0x1c, 0xc3},
        Color{0x20, 0xaf, 0xcd},
        Color{0xec, 0x28, 0x2c},
        Color{0x1e, 0x74, 0xc9},
        Color{0xf1, 0x93, 0x17},
        Color{0xf1, 0xb0, 0x00},
        Color{0x23, 0xcf, 0x23},
        Color{0xf4, 0x59, 0x09},
        Color{0xd1, 0x1e, 0x93},
        Color{0xf1, 0xd4, 0x14},
        Color{0x98, 0x1e, 0xcb},
        Color{0xbc, 0xde, 0x25},
        Color{0xbc, 0xde, 0x25},
      },
      Palette{
        Color{0x9d, 0x22, 0x35},
        Color{0xb3, 0x00, 0x26},
        Color{0xb3, 0xb7, 0xb8},
        Color{0xcf, 0xcf, 0xcf},
        Color{0x4c, 0x8e, 0xc4},
        Color{0x67, 0x89, 0xbf},
      },
      Palette{
        Color{0xab, 0x0c, 0x2f},
        Color{0x00, 0x76, 0xa5},
        Color{0xc8, 0xc9, 0xc7},
        Color{0x88, 0x8b, 0x8d},
        Color{0x00, 0x00, 0x00},
      },
      Palette{
        Color{0x00, 0x5a, 0x9c},
        Color{0xef, 0x3e, 0x42},
        Color{0xa5, 0xac, 0xaf},
      },
      Palette{
        Color{0xfb, 0xbe, 0x4f},
        Color{0x76, 0xd0, 0xc0},
        Color{0x1a, 0xb2, 0x8a},
        Color{0x74, 0x6b, 0xab},
        Color{0x4a, 0x62, 0xd8},
      },
      Palette{
        Color{0x99, 0xc2, 0x21},
        Color{0x80, 0x89, 0x91},
        Color{0x3d, 0x52, 0x65},
        Color{0x58, 0x58, 0x5b},
        Color{0x48, 0xb4, 0xdb},
        Color{0xfa, 0xa7, 0x19},
      },
      Palette{
        Color{0xff, 0xbc, 0xd9},
        Color{0xe1, 0xc1, 0xde},
        Color{0xc3, 0xc5, 0xe2},
        Color{0xa5, 0xca, 0xe7},
        Color{0x87, 0xce, 0xeb},
      },
      Palette{
        Color{0x42, 0x2e, 0xa1},
        Color{0x62, 0x8b, 0x9e},
        Color{0xef, 0xb8, 0x70},
        Color{0x49, 0x11, 0x26},
        Color{0xbf, 0x1e, 0x32},
        Color{0xf4, 0xd6, 0x58},
      },
      Palette{
        Color{0xa7, 0xc6, 0xed},
        Color{0x67, 0x9d, 0xe0},
        Color{0xdc, 0xae, 0x3e},
        Color{0x8c, 0x89, 0x85},
        Color{0x20, 0x54, 0x93},
        Color{0xff, 0xa9, 0x47},
      },
      Palette{
        Color{0xc2, 0x3d, 0x49},
        Color{0x6c, 0x4e, 0x58},
        Color{0x3b, 0x71, 0x5d},
        Color{0xed, 0xd0, 0x74},
        Color{0xef, 0xb8, 0x7d},
      },
      Palette{
        Color{0xf6, 0xae, 0x2d},
        Color{0x29, 0x49, 0x36},
        Color{0x6d, 0xb1, 0xbf},
        Color{0xf2, 0x64, 0x19},
        Color{0x7a, 0x30, 0x6c},
      },
      Palette{
        Color{0x05, 0x11, 0xf2},
        Color{0x10, 0x2d, 0x40},
        Color{0x04, 0x8a, 0xbf},
        Color{0x0d, 0x0d, 0x0d},
        Color{0x03, 0x0a, 0x8c},
      },
      Palette{
        Color{0xa6, 0x26, 0x3e},
        Color{0xf2, 0xe3, 0x07},
        Color{0xd9, 0x04, 0x04},
        Color{0x73, 0x02, 0x02},
        Color{0xf2, 0xf2, 0xf2},
      },
      Palette{
        Color{0xa0, 0x03, 0x42},
        Color{0xf6, 0x84, 0x50},
        Color{0xfc, 0xf3, 0xaa},
        Color{0x9b, 0xd6, 0xa4},
        Color{0x4a, 0x6e, 0xaf},
      },
      Palette{
        Color{0x8f, 0xb9, 0xa8},
        Color{0xfe, 0xfa, 0xd4},
        Color{0xfc, 0xd0, 0xba},
        Color{0xf1, 0x82, 0x8d},
        Color{0x76, 0x5d, 0x69},
      },
      Palette{
        Color{0x5e, 0x52, 0x54},
        Color{0xa1, 0x85, 0x79},
        Color{0xe2, 0xd5, 0xcc},
        Color{0x34, 0x7d, 0xa1},
        Color{0x1a, 0x3d, 0x50},
      },
      Palette{
        Color{0xf2, 0xe6, 0xe3},
        Color{0x21, 0x2c, 0x3d},
        Color{0x58, 0x51, 0x53},
        Color{0xcd, 0xc6, 0xb8},
        Color{0xc0, 0x5e, 0x31},
      },
      Palette{
        Color{0xb1, 0x61, 0x5c},
        Color{0xd8, 0x87, 0x82},
        Color{0xe3, 0xab, 0xa7},
        Color{0xed, 0xd7, 0xd9},
        Color{0xc9, 0xc9, 0xdd},
        Color{0x9d, 0x9d, 0xc7},
        Color{0x82, 0x82, 0xaa},
        Color{0x5a, 0x5a, 0x83},
      },
      Palette{
        Color{0xb1, 0x61, 0x5c},
        Color{0xd8, 0x87, 0x82},
        Color{0xe3, 0xab, 0xa7},
        Color{0xed, 0xd7, 0xd9},
        Color{0xc9, 0xc9, 0xdd},
        Color{0x9d, 0x9d, 0xc7},
        Color{0x82, 0x82, 0xaa},
        Color{0x5a, 0x5a, 0x83},
      },
      Palette{
        Color{0xe7, 0x62, 0x54},
        Color{0xef, 0x8a, 0x47},
        Color{0xf7, 0xaa, 0x58},
        Color{0xff, 0xd0, 0x6f},
        Color{0xff, 0xe6, 0xb7},
        Color{0xaa, 0xdc, 0xe0},
        Color{0x72, 0xbc, 0xd5},
        Color{0x52, 0x8f, 0xad},
        Color{0x37, 0x67, 0x95},
        Color{0x1e, 0x46, 0x6e},
      },
      Palette{
        Color{0xe7, 0x62, 0x54},
        Color{0xef, 0x8a, 0x47},
        Color{0xf7, 0xaa, 0x58},
        Color{0xff, 0xd0, 0x6f},
        Color{0xff, 0xe6, 0xb7},
        Color{0xaa, 0xdc, 0xe0},
        Color{0x72, 0xbc, 0xd5},
        Color{0x52, 0x8f, 0xad},
        Color{0x37, 0x67, 0x95},
        Color{0x1e, 0x46, 0x6e},
      },
      Palette{
        Color{0x6d, 0x2f, 0x20},
        Color{0xb7, 0x53, 0x47},
        Color{0xdf, 0x7e, 0x66},
        Color{0xe0, 0x93, 0x51},
        Color{0xed, 0xc7, 0x75},
        Color{0x94, 0xb5, 0x94},
        Color{0x22, 0x4b, 0x5e},
      },
      Palette{
        Color{0x4e, 0x6d, 0x58},
        Color{0x74, 0x9e, 0x89},
        Color{0xab, 0xcc, 0xbe},
        Color{0xe3, 0xca, 0xcf},
        Color{0xc3, 0x99, 0xa2},
        Color{0x9f, 0x6e, 0x71},
        Color{0x41, 0x50, 0x7b},
        Color{0x7d, 0x87, 0xb2},
        Color{0xc2, 0xca, 0xe3},
      },
      Palette{
        Color{0x7c, 0x66, 0x8c},
        Color{0xb0, 0x8b, 0xa5},
        Color{0xdf, 0xbb, 0xc8},
        Color{0xff, 0xc6, 0x80},
        Color{0xff, 0xb1, 0x78},
        Color{0xdb, 0x88, 0x72},
        Color{0xa5, 0x64, 0x57},
      },
      Palette{
        Color{0x6b, 0x20, 0x0c},
        Color{0x97, 0x3d, 0x21},
        Color{0xda, 0x6c, 0x42},
        Color{0xee, 0x95, 0x6a},
        Color{0xfb, 0xc2, 0xa9},
        Color{0xf6, 0xf2, 0xee},
        Color{0xba, 0xd6, 0xf9},
        Color{0x7d, 0xb0, 0xea},
        Color{0x44, 0x7f, 0xdd},
        Color{0x22, 0x5b, 0xb2},
        Color{0x13, 0x3e, 0x7e},
      },
      Palette{
        Color{0x6b, 0x20, 0x0c},
        Color{0x97, 0x3d, 0x21},
        Color{0xda, 0x6c, 0x42},
        Color{0xee, 0x95, 0x6a},
        Color{0xfb, 0xc2, 0xa9},
        Color{0xf6, 0xf2, 0xee},
        Color{0xba, 0xd6, 0xf9},
        Color{0x7d, 0xb0, 0xea},
        Color{0x44, 0x7f, 0xdd},
        Color{0x22, 0x5b, 0xb2},
        Color{0x13, 0x3e, 0x7e},
      },
      Palette{
        Color{0x42, 0x14, 0x01},
        Color{0x6c, 0x1d, 0x0e},
        Color{0x8b, 0x3a, 0x2b},
        Color{0xc2, 0x76, 0x68},
        Color{0x7b, 0xa0, 0xb4},
        Color{0x44, 0x72, 0x8c},
        Color{0x23, 0x50, 0x70},
        Color{0x0a, 0x2d, 0x46},
      },
      Palette{
        Color{0xdc, 0x86, 0x65},
        Color{0x13, 0x80, 0x85},
        Color{0x54, 0x46, 0x67},
        Color{0xce, 0x76, 0x72},
        Color{0xee, 0xb4, 0x62},
      },
      Palette{
        Color{0xd0, 0x8b, 0x73},
        Color{0xf6, 0xc7, 0x80},
        Color{0x8e, 0xa8, 0xa0},
        Color{0xc0, 0x5c, 0x42},
        Color{0x8a, 0x85, 0x60},
        Color{0x45, 0x5a, 0x6e},
      },
      Palette{
        Color{0xd9, 0x3d, 0x24},
        Color{0xe9, 0x6e, 0x3a},
        Color{0xee, 0xa5, 0x6c},
        Color{0xf4, 0xde, 0xb3},
        Color{0x84, 0xa9, 0xa1},
        Color{0x2f, 0x88, 0x95},
        Color{0x1d, 0x6d, 0x8b},
        Color{0x0c, 0x29, 0x54},
      },
      Palette{
        Color{0xf7, 0xfc, 0xfd},
        Color{0xe0, 0xec, 0xf4},
        Color{0xbf, 0xd3, 0xe6},
        Color{0x9e, 0xbc, 0xda},
        Color{0x8c, 0x96, 0xc6},
        Color{0x8c, 0x6b, 0xb1},
        Color{0x88, 0x41, 0x9d},
        Color{0x81, 0x0f, 0x7c},
        Color{0x4d, 0x00, 0x4b},
      },
      Palette{
        Color{0xf5, 0xed, 0xf3},
        Color{0xf5, 0xe1, 0xed},
        Color{0xf5, 0xd6, 0xf0},
        Color{0xf5, 0xc6, 0xef},
        Color{0xf5, 0xb7, 0xef},
        Color{0xf5, 0xa9, 0xee},
        Color{0xf5, 0x9b, 0xe6},
        Color{0xf5, 0x8c, 0xe4},
        Color{0xf5, 0x7c, 0xe1},
      },
      Palette{
        Color{0x8c, 0xd0, 0xe2},
        Color{0x8f, 0xd3, 0xd8},
        Color{0x8e, 0xd2, 0xcb},
        Color{0x8e, 0xd5, 0xc0},
        Color{0x97, 0xd1, 0xac},
        Color{0xaa, 0xd0, 0x9a},
        Color{0xcd, 0xd7, 0x90},
        Color{0xe9, 0xdc, 0x8e},
        Color{0xfb, 0xda, 0x8e},
        Color{0xf7, 0xc5, 0x88},
        Color{0xfa, 0xc7, 0x89},
        Color{0xf5, 0xb1, 0x8a},
        Color{0xed, 0x97, 0x90},
        Color{0xed, 0x94, 0x9e},
        Color{0xf9, 0xa2, 0xb6},
        Color{0xfc, 0xb6, 0xcd},
        Color{0xf5, 0xb8, 0xd9},
        Color{0xe6, 0xb3, 0xde},
        Color{0xd0, 0xb5, 0xe0},
        Color{0xbb, 0xb8, 0xdf},
        Color{0xa6, 0xbd, 0xdc},
      },
      Palette{
        Color{0xb9, 0xe3, 0xee},
        Color{0xbe, 0xe8, 0xec},
        Color{0xc0, 0xeb, 0xe6},
        Color{0xbb, 0xe7, 0xda},
        Color{0xc1, 0xe4, 0xcd},
        Color{0xcc, 0xe3, 0xc2},
        Color{0xe3, 0xe9, 0xbd},
        Color{0xf2, 0xea, 0xbb},
        Color{0xfd, 0xe9, 0xbb},
        Color{0xfd, 0xde, 0xb8},
        Color{0xfa, 0xd1, 0xb9},
        Color{0xf6, 0xc1, 0xbd},
        Color{0xf9, 0xc2, 0xc8},
        Color{0xfc, 0xc7, 0xd4},
        Color{0xfe, 0xd4, 0xe1},
        Color{0xf9, 0xd4, 0xe8},
        Color{0xf0, 0xd1, 0xeb},
        Color{0xe3, 0xd2, 0xec},
        Color{0xd6, 0xd4, 0xec},
        Color{0xc9, 0xd7, 0xea},
      },
      Palette{
        Color{0xba, 0x31, 0x33},
        Color{0xda, 0x97, 0x23},
        Color{0x5b, 0x80, 0x00},
        Color{0x30, 0x5d, 0xa4},
        Color{0x7c, 0x52, 0x8e},
        Color{0x98, 0x43, 0x18},
      },
      Palette{
        Color{0x18, 0x45, 0x3b},
        Color{0x0d, 0xb1, 0x4b},
        Color{0x97, 0xa2, 0xa2},
        Color{0xf0, 0x85, 0x21},
        Color{0x00, 0x81, 0x83},
        Color{0x90, 0x9a, 0xb7},
        Color{0x53, 0x50, 0x54},
        Color{0xd1, 0xde, 0x3f},
        Color{0xe8, 0xd9, 0xb5},
        Color{0xc8, 0x9a, 0x58},
        Color{0x94, 0xae, 0x4a},
        Color{0x6e, 0x00, 0x5f},
        Color{0xcb, 0x5a, 0x28},
      },
      Palette{
        Color{0x00, 0x21, 0x45},
        Color{0x00, 0x3d, 0x82},
        Color{0x93, 0xd1, 0xe8},
        Color{0x01, 0x66, 0x5e},
        Color{0x76, 0xb7, 0xb2},
        Color{0xa1, 0x92, 0x85},
        Color{0xc8, 0xba, 0x9b},
      },
      Palette{
        Color{0x38, 0x4b, 0x96},
        Color{0x4a, 0xb8, 0xa7},
        Color{0xf4, 0x98, 0x35},
        Color{0x87, 0x87, 0x87},
      },
      Palette{
        Color{0xe5, 0x24, 0x3b},
        Color{0xdd, 0xa6, 0x3a},
        Color{0x4c, 0x9f, 0x38},
        Color{0xc5, 0x19, 0x2d},
        Color{0xff, 0x3a, 0x21},
        Color{0x26, 0xbd, 0xe2},
        Color{0xfc, 0xc3, 0x0b},
        Color{0xa2, 0x19, 0x42},
        Color{0xfd, 0x69, 0x25},
        Color{0xdd, 0x13, 0x67},
        Color{0xfd, 0x9d, 0x24},
        Color{0xbf, 0x8b, 0x2e},
        Color{0x3f, 0x7e, 0x44},
        Color{0x0a, 0x97, 0xd9},
        Color{0x56, 0xc0, 0x2b},
        Color{0x00, 0x68, 0x9d},
        Color{0x19, 0x48, 0x6a},
      },
      Palette{
        Color{0x8b, 0x52, 0x50},
        Color{0x3c, 0x4c, 0x53},
        Color{0xe3, 0xe3, 0xe3},
        Color{0x8e, 0x8e, 0x89},
        Color{0xc6, 0xb9, 0x8e},
        Color{0xfb, 0xb6, 0x09},
        Color{0x7a, 0x71, 0x76},
        Color{0xb5, 0xb5, 0xb5},
        Color{0xc8, 0xc9, 0xcc},
        Color{0xc6, 0xbb, 0xb3},
        Color{0xd4, 0xcd, 0xb7},
        Color{0x5c, 0x74, 0x94},
        Color{0xd5, 0xcb, 0xc8},
        Color{0xdf, 0xd8, 0xcb},
        Color{0x64, 0x7c, 0x6c},
        Color{0xa4, 0xa4, 0xac},
      },
      Palette{
        Color{0x1d, 0x25, 0x2d},
        Color{0x00, 0x22, 0x44},
        Color{0x0c, 0x2c, 0x56},
        Color{0x35, 0x54, 0x64},
        Color{0x68, 0xa2, 0xb9},
        Color{0xc4, 0xce, 0xd4},
        Color{0x01, 0x55, 0x46},
        Color{0x99, 0xd9, 0xd9},
        Color{0x00, 0x65, 0x3a},
        Color{0x03, 0x74, 0x26},
        Color{0x65, 0x8d, 0x1b},
        Color{0x69, 0xbe, 0x28},
        Color{0xe9, 0x3b, 0x16},
        Color{0xff, 0xc2, 0x00},
      },
      Palette{
        Color{0xfc, 0xff, 0xa4},
        Color{0xf1, 0xed, 0x71},
        Color{0xf6, 0xd5, 0x43},
        Color{0xfb, 0xba, 0x1f},
        Color{0xfc, 0xa1, 0x08},
        Color{0xf8, 0x87, 0x0e},
        Color{0xf1, 0x71, 0x1f},
        Color{0xe5, 0x5c, 0x30},
        Color{0xd7, 0x4b, 0x3f},
        Color{0xc4, 0x3c, 0x4e},
        Color{0xb1, 0x32, 0x5a},
        Color{0x9b, 0x29, 0x64},
        Color{0x87, 0x21, 0x6b},
        Color{0x71, 0x19, 0x6e},
        Color{0x5c, 0x12, 0x6e},
        Color{0x45, 0x0a, 0x69},
        Color{0x2f, 0x0a, 0x5b},
        Color{0x18, 0x0c, 0x3c},
        Color{0x08, 0x05, 0x1d},
        Color{0x00, 0x00, 0x04},
      },
      Palette{
        Color{0x2d, 0x47, 0xa7},
        Color{0xc9, 0x14, 0x2b},
        Color{0xfd, 0xca, 0x32},
        Color{0x5e, 0x7e, 0x95},
      },
      Palette{
        Color{0xff, 0xc2, 0x8b},
        Color{0xff, 0x94, 0x63},
        Color{0xfe, 0x6d, 0x4e},
        Color{0xff, 0x53, 0x42},
        Color{0x81, 0x98, 0x98},
        Color{0x4c, 0x7d, 0x8e},
        Color{0x17, 0x4d, 0x7c},
        Color{0x1c, 0x28, 0x4e},
      },
      Palette{
        Color{0x12, 0x51, 0x83},
        Color{0x78, 0xa5, 0xde},
        Color{0xff, 0xdf, 0xba},
        Color{0xff, 0xff, 0xff},
        Color{0x9e, 0xb8, 0x93},
      },
      Palette{
        Color{0xe8, 0xf0, 0x86},
        Color{0x6f, 0xde, 0x6e},
        Color{0xff, 0x42, 0x42},
        Color{0xa6, 0x91, 0xae},
        Color{0x23, 0x5f, 0xa4},
        Color{0x0a, 0x28, 0x4b},
      },
      Palette{
        Color{0xbd, 0xd9, 0xbf},
        Color{0x92, 0x90, 0x84},
        Color{0xff, 0xc8, 0x57},
        Color{0xa9, 0x97, 0xdf},
        Color{0xe5, 0x32, 0x3b},
        Color{0x2e, 0x40, 0x52},
      },
      Palette{
        Color{0xe1, 0xda, 0xae},
        Color{0xff, 0x93, 0x4f},
        Color{0xcc, 0x2d, 0x35},
        Color{0x05, 0x8e, 0xd9},
        Color{0x84, 0x8f, 0xa2},
        Color{0x2d, 0x31, 0x42},
      },
      Palette{
        Color{0xff, 0xff, 0xff},
        Color{0xe6, 0xe6, 0xe6},
        Color{0xb3, 0xb3, 0xb3},
        Color{0x66, 0x66, 0x66},
        Color{0x4d, 0x4d, 0x4d},
        Color{0x33, 0x33, 0x33},
        Color{0x1a, 0x1a, 0x1a},
        Color{0x0d, 0x0d, 0x0d},
        Color{0x00, 0x00, 0x00},
      },
      Palette{
        Color{0x1b, 0xcf, 0xc9},
        Color{0x2e, 0xcc, 0x71},
        Color{0xf1, 0xc4, 0x0f},
        Color{0xd3, 0x54, 0x00},
        Color{0x96, 0x00, 0x75},
      },
      Palette{
        Color{0x03, 0x54, 0x4e},
        Color{0x07, 0x67, 0x82},
        Color{0x07, 0x3e, 0x92},
        Color{0x4b, 0x00, 0xb5},
        Color{0x55, 0x00, 0x7f},
        Color{0xa1, 0x00, 0x50},
        Color{0xd0, 0x00, 0x00},
      },
      Palette{
        Color{0xf2, 0x63, 0x86},
        Color{0xf5, 0x88, 0xaf},
        Color{0xa4, 0xd9, 0x84},
        Color{0xfc, 0xbc, 0x52},
        Color{0xfd, 0x81, 0x4e},
      },
      Palette{
        Color{0xff, 0xcd, 0x02},
        Color{0xee, 0x30, 0x20},
        Color{0x25, 0x42, 0x8e},
        Color{0x08, 0x9e, 0xdd},
        Color{0x00, 0x96, 0x3f},
        Color{0xf4, 0x87, 0x9a},
        Color{0xb1, 0x62, 0x3b},
      },
      Palette{
        Color{0x00, 0x92, 0xd7},
        Color{0xeb, 0x1b, 0x28},
        Color{0x03, 0xb4, 0x59},
        Color{0xa5, 0x6c, 0x59},
        Color{0x0c, 0xaa, 0xab},
        Color{0x9f, 0x63, 0xa3},
        Color{0xf2, 0x67, 0xa8},
      },
      Palette{
        Color{0x00, 0x20, 0x5b},
        Color{0xbf, 0x0d, 0x3e},
        Color{0x00, 0xa9, 0xe0},
        Color{0xff, 0x80, 0x8b},
        Color{0xff, 0x67, 0x1f},
        Color{0x6e, 0xce, 0xb2},
        Color{0xf0, 0xb3, 0x23},
        Color{0x58, 0x44, 0x46},
        Color{0xff, 0xff, 0xff},
        Color{0x00, 0x00, 0x00},
      },
      Palette{
        Color{0xbf, 0x0d, 0x3e},
        Color{0xff, 0xff, 0xff},
        Color{0x00, 0x20, 0x5b},
      },
      Palette{
        Color{0xee, 0x42, 0x66},
        Color{0xff, 0xd2, 0x3f},
        Color{0x00, 0xa5, 0xcf},
        Color{0x3b, 0xce, 0xac},
        Color{0x0e, 0xad, 0x69},
        Color{0x54, 0x0d, 0x6e},
      },
      Palette{
        Color{0x2d, 0x3e, 0x50},
        Color{0xff, 0x7a, 0x59},
        Color{0xf5, 0xc1, 0x6b},
      },
      Palette{
        Color{0x01, 0xb8, 0xaa},
        Color{0x37, 0x46, 0x49},
        Color{0xfd, 0x62, 0x5e},
        Color{0xf2, 0xc8, 0x0f},
        Color{0x5f, 0x6b, 0x6d},
        Color{0x8a, 0xd4, 0xeb},
        Color{0xfe, 0x96, 0x66},
        Color{0xa6, 0x69, 0x99},
        Color{0x35, 0x99, 0xb8},
        Color{0xdf, 0xbd, 0xbf},
      },
      Palette{
        Color{0xef, 0x7c, 0x8e},
        Color{0xfa, 0xe8, 0xe0},
        Color{0xb6, 0xe2, 0xd3},
        Color{0xd8, 0xa7, 0xb1},
      },
      Palette{
        Color{0xaf, 0xc9, 0xb5},
        Color{0x4b, 0x45, 0x45},
        Color{0xe5, 0xde, 0xdb},
        Color{0x3f, 0x3f, 0x3f},
        Color{0xe4, 0xdd, 0xd8},
        Color{0xcd, 0xaf, 0xba},
        Color{0xba, 0x8e, 0x2c},
        Color{0x96, 0x8c, 0x8c},
        Color{0x56, 0x82, 0x78},
        Color{0xea, 0xb2, 0x90},
        Color{0xb8, 0x5b, 0x22},
        Color{0x68, 0x7f, 0xa0},
      },
    };
    int x, y, idx = 0, pidx = 0;
};

PaletteViewer::PaletteViewer(int _x, int _y) : x{_x}, y{_y} { }

void PaletteViewer::next() {
  ++pidx;
}

void PaletteViewer::prev() {
  --pidx;
}

void PaletteViewer::render() {
  SDL_Rect options = {x, y, 400, 40};
  SDL_SetRenderDrawColor(gRenderer, 0x80, 0x80, 0x80, 0);
  SDL_RenderFillRect(gRenderer, &options);

  Palette palette = palettes[pidx];

  for (int i = 0; i < palette.size() && i < 10; ++i) {
    Color color = palette[i];
    SDL_Rect tile = {x + (40 * i), y, 40, 40};
    SDL_SetRenderDrawColor(gRenderer, color.r, color.g, color.b, 0);
    SDL_RenderFillRect(gRenderer, &tile);
  }
}

void PaletteViewer::handle_click(int click_x, int click_y) {
  // TODO: this calculation depends on knowing the tile width
  Palette palette = palettes[pidx];
  int _idx = (click_x - x) / 40;
  if (_idx < palette.size())
    idx = _idx;
}

Color& PaletteViewer::get_color() {
  return palettes[pidx][idx];
}

class MiniMap {
 public:
    MiniMap(int, int);
    void render(const std::array<Color, 10000>&);

 private:
    int x, y;
};

MiniMap::MiniMap(int _x, int _y) : x{_x}, y{_y} { }

void MiniMap::render(const std::array<Color, 10000>& real) {
  SDL_Rect bg = {x, y, 400, 80};
  SDL_SetRenderDrawColor(gRenderer, 0x80, 0x80, 0x80, 0);
  // SDL_SetRenderDrawColor(gRenderer, 0xFF, 0x00, 0x00, 0);
  SDL_RenderFillRect(gRenderer, &bg);

  int _x = 0, _y = 0;
  for (int i = 0; i < real.size(); ++i) {
    Color color = real[i];
    SDL_SetRenderDrawColor(gRenderer, color.r, color.g, color.b, 0);
    SDL_RenderDrawPoint(gRenderer, _x++ + x, _y + y);

    if (i % 100 == 0) {
      ++_y;
      _x = 0;
    }
  }
}

class PixelArt {
 public:
    PixelArt();

    void handle_click(int, int, bool);
    void end_event();
    void undo();
    void next_color();
    void prev_color();
    void render();
    void zoom(int);
    void pan(int, int);

 private:
    std::array<Color, 100*100> real;
    TileField field;
    PaletteViewer p;
    MiniMap m;
    std::vector<std::vector<Change>> history;
};

PixelArt::PixelArt()
: field{100, 100, 400, 400, real}, p{100, 500}, m{100, 540} {}

void PixelArt::next_color() {
  p.next();
}

void PixelArt::prev_color() {
  p.prev();
}

void PixelArt::handle_click(int click_x, int click_y, bool shift) {
  if (click_x > 100 && click_x < 500 && click_y > 100) {
    if (click_y < 500) {
      field.handle_click(click_x, click_y, shift);
    } else if (click_y < 540) {
      p.handle_click(click_x, click_y);
      field.set_color(p.get_color());
    }
  }
}

void PixelArt::end_event() {
  field.end_event();
  if (field.changelist.size() == 0)
    return;

  history.push_back(field.changelist);
  field.changelist.clear();
}

void PixelArt::undo() {
  if (history.size() == 0)
    return;

  std::vector<Change> changelist = history.back();
  history.pop_back();
  field.play(changelist);
}

void PixelArt::render() {
  field.render();
  p.render();
  m.render(real);
}

void PixelArt::zoom(int change) {
  field.zoom(change);
}

void PixelArt::pan(int change_x, int change_y) {
  field.pan(change_x, change_y);
}

bool init() {
  // Initialization flag
  bool success = true;

  // Initialize SDL
  if (SDL_Init(SDL_INIT_VIDEO) < 0) {
    printf("SDL could not initialize! SDL Error: %s\n", SDL_GetError());
    return false;
  }

  // Set texture filtering to linear
  if (!SDL_SetHint(SDL_HINT_RENDER_SCALE_QUALITY, "1")) {
    printf("Warning: Linear texture filtering not enabled!");
  }

  gWindow = SDL_CreateWindow("", SDL_WINDOWPOS_UNDEFINED,
      SDL_WINDOWPOS_UNDEFINED, SCREEN_WIDTH, SCREEN_HEIGHT, SDL_WINDOW_SHOWN);
  if (gWindow == NULL) {
    printf("Window could not be created! SDL Error: %s\n", SDL_GetError());
    success = false;
  } else {
    gRenderer = SDL_CreateRenderer(gWindow, -1, SDL_RENDERER_ACCELERATED);
        // SDL_RENDERER_ACCELERATED | SDL_RENDERER_PRESENTVSYNC);
    if (gRenderer == NULL) {
      printf("Renderer could not be created! SDL Error: %s\n",
          SDL_GetError());
      success = false;
    } else {
      SDL_SetRenderDrawColor(gRenderer, 0xBA, 0xBA, 0xBA, 0xBA);
    }
  }

  return success;
}

void close() {
  SDL_DestroyRenderer(gRenderer);
  SDL_DestroyWindow(gWindow);
  gWindow = NULL;
  gRenderer = NULL;

  SDL_Quit();
}

int main(int argc, char* args[]) {
  if (!init()) {
    printf("Failed to initialize!\n");
    return -1;
  }
  PixelArt app {};
  bool quit = false;
  bool click = false;
  bool last = false;
  bool shift = false;
  int click_x, click_y;
  while (!quit) {
    SDL_Event e;
    while (SDL_PollEvent(&e) != 0) {
      switch (e.type) {
        case SDL_QUIT:
          quit = true;
          break;
        case SDL_KEYDOWN:
          if (e.key.keysym.mod & KMOD_SHIFT) {
            shift = true;
          }
          switch (e.key.keysym.sym) {
            case 'q':
              quit = true;
              break;
            case SDLK_UP:
              app.zoom(1);
              break;
            case SDLK_DOWN:
              app.zoom(-1);
              break;
            case SDLK_TAB:
              if (e.key.keysym.mod & KMOD_SHIFT)
                app.prev_color();
              else
                app.next_color();
              break;
            case 'h':
              app.pan(-5, 0);
              break;
            case 'j':
              app.pan(0, 5);
              break;
            case 'k':
              app.pan(0, -5);
              break;
            case 'l' :
              app.pan(5, 0);
              break;
            case 'u':
              app.undo();
          }
          break;
        case SDL_KEYUP:
          if ((e.key.keysym.mod & KMOD_SHIFT) == 0) {
            shift = false;
          }
        case SDL_MOUSEMOTION:
          if (e.motion.state & SDL_BUTTON_LMASK) {
            click_x = e.motion.x;
            click_y = e.motion.y;
          }
          break;
        case SDL_MOUSEBUTTONDOWN:
          if (e.button.button == SDL_BUTTON_LEFT) {
            click = true;
            click_x = e.button.x;
            click_y = e.button.y;
          }
          break;
        case SDL_MOUSEBUTTONUP:
          if (e.button.button == SDL_BUTTON_LEFT)
            click = false;
          break;
      }
    }

    if (click == true) {
      app.handle_click(click_x, click_y, shift);
      last = click;
    } else if (last == true) {
      // end of sequence
      app.end_event();
    }

    // Non-white background
    SDL_SetRenderDrawColor(gRenderer, 0xBA, 0xBA, 0xBA, 0);
    SDL_RenderClear(gRenderer);

    app.render();

    SDL_RenderPresent(gRenderer);
  }

  close();

  return 0;
}
